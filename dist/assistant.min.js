/**
 * AssistantAILike v1.0.0 - Minified JS
 * https://github.com/xgueret/assistantailike
 * @license MIT
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).AssistantAILike=t()}(this,function(){"use strict";const e={buttonSelector:"#assistantButton",containerSelector:"#assistantContainer",closeBtnSelector:"#assistantCloseBtn",messagesSelector:"#assistantMessages",inputSelector:"#assistantInput",sendBtnSelector:"#assistantSendBtn",quickRepliesSelector:".assistant-quick-reply-btn",typingDelay:500,welcomeMessage:null,knowledge:{},keywords:{},onOpen:null,onClose:null,onMessageSent:null,onMessageReceived:null,onNotFound:null,notFoundMessage:"Sorry, I couldn't find information on that topic. Try one of the suggested topics.",inputPlaceholder:"Type your question...",customAnswerFn:null};class t{constructor(t={}){this.options={...e,...t},this.elements={},this.isOpen=!1,this.isTyping=!1,this._init()}_init(){this._getElements(),this._bindEvents(),this.options.welcomeMessage&&this.addMessage(this.options.welcomeMessage,!1)}_getElements(){this.elements={button:document.querySelector(this.options.buttonSelector),container:document.querySelector(this.options.containerSelector),closeBtn:document.querySelector(this.options.closeBtnSelector),messages:document.querySelector(this.options.messagesSelector),input:document.querySelector(this.options.inputSelector),sendBtn:document.querySelector(this.options.sendBtnSelector),quickReplies:document.querySelectorAll(this.options.quickRepliesSelector)}}_bindEvents(){const{button:e,closeBtn:t,sendBtn:s,input:i,quickReplies:n}=this.elements;e&&e.addEventListener("click",()=>this.toggle()),t&&t.addEventListener("click",()=>this.close()),s&&s.addEventListener("click",()=>this._handleSend()),i&&i.addEventListener("keypress",e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),this._handleSend())}),n&&n.length>0&&n.forEach(e=>{e.addEventListener("click",()=>{const t=e.dataset.question||e.textContent.trim();this.elements.input&&(this.elements.input.value=t),this._handleSend()})}),document.addEventListener("keydown",e=>{"Escape"===e.key&&this.isOpen&&this.close()})}toggle(){this.isOpen?this.close():this.open()}open(){const{container:e,button:t,input:s}=this.elements;e&&e.classList.add("active"),t&&t.classList.add("active"),s&&s.focus(),this.isOpen=!0,"function"==typeof this.options.onOpen&&this.options.onOpen()}close(){const{container:e,button:t}=this.elements;e&&e.classList.remove("active"),t&&t.classList.remove("active"),this.isOpen=!1,"function"==typeof this.options.onClose&&this.options.onClose()}addMessage(e,t=!1){const{messages:s}=this.elements;if(!s)return;const i=document.createElement("div");i.className=`assistant-message ${t?"user":"bot"}`;const n=document.createElement("div");return n.className="assistant-message-content",n.innerHTML=e,i.appendChild(n),s.appendChild(i),this._scrollToBottom(),i}showTyping(){const{messages:e}=this.elements;if(!e||this.isTyping)return;this.isTyping=!0;const t=document.createElement("div");return t.className="assistant-message bot assistant-typing-indicator",t.innerHTML='\n                <div class="assistant-message-content">\n                    <div class="assistant-typing">\n                        <span class="assistant-typing-dot"></span>\n                        <span class="assistant-typing-dot"></span>\n                        <span class="assistant-typing-dot"></span>\n                    </div>\n                </div>\n            ',e.appendChild(t),this._scrollToBottom(),t}hideTyping(){const{messages:e}=this.elements;if(!e)return;const t=e.querySelector(".assistant-typing-indicator");t&&t.remove(),this.isTyping=!1}_scrollToBottom(){const{messages:e}=this.elements;e&&(e.scrollTop=e.scrollHeight)}_normalizeText(e){return e.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").trim()}findAnswer(e){const{knowledge:t,keywords:s}=this.options,i=this._normalizeText(e);for(const[e,s]of Object.entries(t)){if(i.includes(this._normalizeText(e)))return"object"==typeof s&&s.title&&s.content?`<strong>${s.title}</strong><br>${s.content}`:s}for(const[e,n]of Object.entries(s))if(i.includes(e)){const e=t[n];if(e)return"object"==typeof e&&e.title&&e.content?`<strong>${e.title}</strong><br>${e.content}`:e}return null}async _handleSend(){const{input:e}=this.elements;if(!e)return;const t=e.value.trim();if(""===t)return;this.addMessage(t,!0),e.value="","function"==typeof this.options.onMessageSent&&this.options.onMessageSent(t),this.showTyping();let s;if("function"==typeof this.options.customAnswerFn)try{s=await this.options.customAnswerFn(t)}catch(e){console.error("AssistantAILike: Error in custom answer function",e),s=this.options.notFoundMessage}else await this._delay(this.options.typingDelay),s=this.findAnswer(t);this.hideTyping(),s?(this.addMessage(s),"function"==typeof this.options.onMessageReceived&&this.options.onMessageReceived(s)):(this.addMessage(this.options.notFoundMessage),"function"==typeof this.options.onNotFound&&this.options.onNotFound(t))}_delay(e){return new Promise(t=>setTimeout(t,e))}updateKnowledge(e){this.options.knowledge={...this.options.knowledge,...e}}updateKeywords(e){this.options.keywords={...this.options.keywords,...e}}clearMessages(){const{messages:e}=this.elements;e&&(e.innerHTML="")}destroy(){this.close(),this.elements={}}}return function(){const e=document.querySelector("[data-assistant-auto-init]");if(e){const s=e.getAttribute("data-assistant-config");let i={};if(s)try{i=JSON.parse(s)}catch(e){console.warn("AssistantAILike: Invalid JSON in data-assistant-config")}window.assistantAILike=new t(i)}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",autoInit):autoInit(),t});
